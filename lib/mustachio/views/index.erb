<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>untitled</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Bay">	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js" type="text/javascript"></script>

  
</head>
<body>
  
  <div id="loading">loading...</div>
  <div id="failed" style="display:none">
    sorry, but you need to be logged into facebook.
  </div>
  <div id="success" style="display:none">
    <img id="mustache" src="" />
  </div>
  
  <!-- needed for facebook, don't delete! -->
  <div id="fb-root"></div>
  
  <script type="text/javascript">
  
      // Load the Facebook SDK Asynchronously
      (function(d){
         var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
         js = d.createElement('script'); js.id = id; js.async = true;
         js.src = "http://connect.facebook.net/en_US/all.js";
         d.getElementsByTagName('head')[0].appendChild(js);
       }(document));
  
      //function to initialize facebook once loaded
      window.fbAsyncInit = function() {
        FB.init({
         appId  : '<%= FacebookAPI::APP_ID %>',
         status : true, // check login status
         cookie : true, // enable cookies to allow the server to access the session
        // channelUrl : 'http://whatsherface-book.com/channel.html',
         xfbml  : true  // parse XFBML
        });

        //try to grab FB id
        FB.getLoginStatus( function(response){
         if ( response.authResponse.userID ) 
           showMustache( response.authResponse.userID  );
         else 
           cantShowMustache();
        });
      }

      //Grabbed FB id, now show picture
      function showMustache( uid ){
        $('#loading').hide();
        var path = "/?src=http://graph.facebook.com/" + uid + "/picture?type=large";
        $('#mustache').attr('src', path);
        $('#success').show();
      }

      //could not grab FB id
      function cantShowMustache(){
        $('#loading').hide();
        $('#failed').show();
      }

  </script>

</body>
</html>
